---
title: Building A Gatsby Blog Site With MDX And Graphql
slug: Building-A-Gatsby-Blog-Site-With-MDX-And-Graphql
date: 2020-03-21
featureImage: gatsby-mdx-graphql-blog.png
excerpt: Itâ€™s been a while since I started web development. In this article, I will explain how I started coding, from making a single basic component to complex components, breaking complex code into a single piece of components to render a single file into the browser and other stuff.
---

## Preparing Local Environment

- Install NodeJS

> [Link to download Node](https://nodejs.org/en/download/)

- Install git, optional

- Install gatsby cli:

```js
npm install -g gatsby-cli
```

on your command prompt, install:

`command prompt`

```js
gatsby new gatsby-site https://github.com/gatsbyjs/gatsby-starter-hello-world
```

### Installing gatsby plugins and other resources and libraries

- Install gatsby file source:

```js
npm install gatsby-source-filesystem
```

- Gatsby source file system setup:
  - Create a folder at the root of your file and name it " gatsby-config.js" with this code inside it:

`gatsby-config.js`

```js
module.exports = {
  plugins: [
    {
      resolve: `gatsby-source-filesystem`,
      options: {
        name: `pages`,
        path: `${__dirname}/src/pages`,
      },
    },
    {
      resolve: `gatsby-source-filesystem`,
      options: {
        name: `posts`,
        path: `${__dirname}/src/posts`,
      },
    },
    {
      resolve: `gatsby-source-filesystem`,
      options: {
        name: `images`,
        path: `${__dirname}/src/images`,
      },
    },
  ],
}
```

- Create "posts" folder where all the posts will be stored . - - Create "images" folder where all the or some of the images stored.

Install:

```jsx
 npm install gatsby-transformer-sharp gatsby-plugin-sharp
```

- Add "gatsby-transformer-sharp gatsby-plugin-sharp" in the gatsby-config file, and it should look like this code below:

`gatsby-config.js`

```js
module.exports = {
  plugins: [
    {
      //gatsby source filesystem installed
      resolve: `gatsby-source-filesystem`,
      options: {
        name: `pages`,
        path: `${__dirname}/src/pages`,
      },
    },
    {
      resolve: `gatsby-source-filesystem`,
      options: {
        name: `posts`,
        path: `${__dirname}/src/posts`,
      },
    },
    {
      resolve: `gatsby-source-filesystem`,
      options: {
        name: `images`,
        path: `${__dirname}/src/images`,
      },
    },
    //added gatsby-transformer-sharp gatsby-plugin-sharp
    `gatsby-plugin-sharp`,
    `gatsby-transformer-sharp`,
  ],
}
```

- Install following below, for markdown, and for images:

1. Markdown plugin

```jsx
npm install gatsby-plugin-mdx @mdx-js/mdx @mdx-js/react
```

2. Images plugin

```js
npm install gatsby-remark-images
```

- Add both this line of code to your gatsby-config.js file. Check the code below.

`gatsby-config.js`

```js
module.exports = {
  plugins: [
    {
      resolve: `gatsby-source-filesystem`,
      options: {
        name: `pages`,
        path: `${__dirname}/src/pages`,
      },
    },
    {
      resolve: `gatsby-source-filesystem`,
      options: {
        name: `posts`,
        path: `${__dirname}/src/posts`,
      },
    },
    {
      resolve: `gatsby-source-filesystem`,
      options: {
        name: `images`,
        path: `${__dirname}/src/images`,
      },
    },

    `gatsby-plugin-sharp`,
    `gatsby-transformer-sharp`,

    //MDx and Image plugin
    {
      resolve: `gatsby-plugin-mdx`,
      options: {
        extensions: [`.mdx`, `.md`],
        gatsbyRemarkPlugins: [
          {
            resolve: `gatsby-remark-images`,
            options: {
              maxWidth: 1200,
            },
          },
        ],
      },
    },
  ],
}
```

### Installing Google fonts from gatsby plugin

```js
npm install gatsby-plugin-google-fonts
```

- Add the code after the mdx and plugin query.

```js
{
      resolve: `gatsby-plugin-google-fonts`,
      options: {
        fonts: [
          `'Source Code Pro'`,
          `source sans pro\:300,400,400i,700`, // you can also specify font weights and styles
        ],
        display: "swap",
      },
    },
```

### Installing the Frontmatter plugin

- Add a folder called first post and a file name called index.mdx inside it or whatever the folder title you like inside the folder posts.

- add an image of your choice to use. The path should be like this, src-posts-firstpostfolder-index.mdx

- Run the local server.

```js
npm run develop
```

<p>
  If it is successful, you see http://localhost:8000/___graphql. copy that and
  paste it on the browser
</p>

<p>You can now have access to the graphql query site.</p>

- Check the image below for graphql.

![Graphql mage](first-graphql-query.PNG)

<p>
  If you see the graphql image above, your doing fine. We'll use graphql query
  later in this tutorial
</p>

### Install Styled Components for css.

<p>
  This is a CSS in JS where you can have access to it wherever you want to use
  it.
</p>

- Install both styled components and babel plugin at the same time, just copy
  the code below and paste it on your command prompt or VS Code editor

```js
npm install gatsby-plugin-styled-components styled-components babel-plugin-styled-components

```

- Create a folder, and name it "themes" under the SRC or source folder. Inside
  the "themes folder, create a file and name it "theme.js" without "s"

- Put this code inside the theme.js file in later use, or you can creat your
  custom css for your projects

`theme.js`

```css
export default {
  fonts: {
    main: "Source Code Pro, Source Sans Pro",
    code: "Roboto Mono, monospace",
  },

  colors: {
    main1: "hsl(207, 70%, 59%)",
    main2: "hsl(207, 70%, 94%)",
    dark1: "hsl(227, 2%, 12%)",
    dark2: "hsl(227, 2%, 26%)",
    dark3: "hsl(227, 2%, 64%)",
    light1: "hsl(0, 0%, 97%)",
    light2: "hsl(0, 0%, 99%)",
  },

  breakpoints: {
    mobile: "only screen and (max-width: 50rem)",
    tablet: "only screen and (max-width: 65rem)",
  },

  spacings: {
    xxSmall: ".25rem",
    xSmall: ".5rem",
    small: "1rem",
    medium: "2rem",
    large: "3rem",
    xLarge: "4rem",
    xxLarge: "6rem",
  },
  animations: {
    button: "box-shadow 0.3s ease",
    link: "color 0.2s ease",
  },
  shadows: {
    shadow1: "0px 5px 20px rgba(30, 30, 31, 0.05)",
  },
}
```

- Create "gatsby-browser.js" file into the root folder, and then create "gatsby-ssr.js" file also into the root of the project.

- Put this code inside the gatsby-browser.js. All the files inside the gatsby-browser.js should be the same as the gatsby.ssr.js, so we need to copy this to our gatsby-ssr.js also.

- gatsby-browser.js and gatsby-ssr.js code below

`gatsby-browser.js/gatsby-ssr.js`

```js
import React from "react"
import { createGlobalStyle, ThemeProvider } from "styled-components"
import Theme from "./src/themes/theme"

const GlobalStyles = createGlobalStyle`
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}
body, html{
    font-family: ${props => props.theme.fonts.main};
    height: 100%;
    background-color: ${props => props.theme.colors.light1};
}
`

export const wrapRootElement = ({ element }) => (
  <ThemeProvider theme={Theme}>
    <GlobalStyles />
    {element}
  </ThemeProvider>
)
)
```

<p>
  I also added the GlobalStyles in the above code, this means that this is the
  global styles/css for the whole application, and can change some of the
  properties in a separate file if we want to change some colors, fonts,
  background, etc. In this project's case we already created a "theme" above, so
  we can access it to any component in our project.
</p>

### Create Pages Gatsby Node

#### "Create pages programmatically"

<p>
  Now is the time we can use our graphql query that I showed you in the above.
</p>

- Again, type: "npm run develop" on your command prompt. If it's successful, click on the link or copy and paste it on your browser;

- Copy the code below and paste it on your query and hit the Play button.

`Graphiql query`

```js
query MyQuery {
  allMdx(sort: {fields: frontmatter___date, order: DESC}) {
    edges {
      node {
        frontmatter {
          slug
        }
        id
      }
    }
  }
}
```

<p>
  When you paste the the code above and played it in the graphiql, it showed you
  what is really happening behind these query that you input. You can check that
  at the right of your query. Note that this is query for creating pages
  programmatically.
</p>

- Create a js file at the root of your project folder and name it "gatsby-node.js". Inside this file paste the code you queried in the graphiql. Your code should look like the code below:

`gatsby-node.js`

```js
exports.createPages = async function ({ actions, graphql }) {
  const { data } = await graphql`
    query {
      allMdx(sort: { fields: frontmatter___date, order: DESC }) {
        edges {
          node {
            frontmatter {
              slug
            }
            id
          }
        }
      }
    }
  `
```

### Creating Paginated Pages For Posts

<p>
  In this section, we are going to create our paginated pages for our post. The
  code below will be added to "gatsby-node.js" file.
</p>

`Just add this code inside the gatsby-node.js after the above code`

```js
const postPerPage = 3
const numPages = Math.ceil(data.allMdx.edges.length / postPerPage)

Array.from({ length: numPages }).forEach((_, i) => {
  actions.createPages({
    path: i === 0 ? `/` : `/${i + 1}`,
    component: require.resolve("./src/templates/allPost.js"),
    context: {
      limit: postPerPage,
      skip: i * postPerPage,
      numPages,
      currentPage: i + 1,
    },
  })
})
```

- Create a sub-folder "elements" under source folder that will contain elements for every components that we are going to create in the "components" folder later in this lessons.

- Inside the "elements folder" create a file called "ContainerElements.js" or any name you want with the same pattern to avoid confusions, write the code below inside this file:

`ContainerElements.js`

```js
import styled from "styled-components"

export const ContainerWrapper = styled.div`
  height: 100%;
  display: grid;
  grid-template-columns: 1fr repeat(12, minmax(auto, 4.2rem)) 1fr;
  grid-template-rows: 7.8rem 20rem 5rem auto;
  gap: 0 2rem;

  @media ${props => props.theme.breakpoints.tablet} {
    grid-template-columns: 2rem repeat(6, 1fr) 2rem;
    grid-gap: 0 1rem;
  }
  @media ${props => props.theme.breakpoints.mobile} {
    grid-template-columns: 0.5rem repeat(6, 1fr) 0.5rem;
  }

```

- Don't forget to create an index.js so we can export our ContainerElements.js. This should be inside the "elements" folder with the ContainerElements.js.

`index.js`

```js
export * from "./ContainerElements"
```

<p>
  And that is the first export that we have inside our index.js, that means we
  can use any elements inside that file by just importing it directly from the
  subfolder called "elements"
</p>

- Now, create our "components" folder under the SRC folder where we can store every components that we are going to create in this tutorial.

<p>
  Let's start by adding a component called "Container.js", and the "index.js"
  where we can export our Container.js file. This is the same steps when we
  created the ContainerElements.js above.
</p>

- Just copy the code below to our "Container.js file below:

`Container.js`

```js
import React from "react"
import { ContainerWrapper } from "../elements"

export const Container = ({ children }) => {
  return <ContainerWrapper>{children}</ContainerWrapper>
}
```

- Wait, don't forget to export our Container.js in our "index.js" under the "components" folder.
  `index.js`

```js
export * from "./Container"
```

`Note that we have already created two index.js with a separate folder. The index.js inside the "elements" folder and the index.js inside the "components" folder.`

<p>
  Notice that the ContainerElements.js and the Container.js are directly
  communicating each other.
</p>

- Instead of typing the complete path like:

```js
import ContainerElements from "./src/elements/ContainerElements"
```

- You can just import it directly like:

```js
import { ContainerWrapper } from "../elements"
```

- Now that we have the ContainerElements.js and the Container.js we can use, we can now import the Container.js to our new index.js which we are going to create inside the "pages" folder.

`NOTE`

<p>
  "pages" folder was automatically generated when we first created our
  "gatsby-starter-hello-world", if you don't see the "pages" folder, create one
  under the "SRC" folder, and inside "pages" folder, again, add an "index.js"
  file.
</p>

`index.js`

```js
import React from "react"
import { Container } from "../components"

const IndexPage = () => {
  return (
    <Container>
      <h1>Hello World From Index Page</h1>
    </Container>
  )
}
export default IndexPage
```

### Navigation Component

<p>
  We are going to repeat the process as we did in the Container.js and the
  ContainerElements.js.
</p>

- Create a file and name it "NavElements.js". This file will also put inside the "elements" folder along with the ContainerElements.js. Type the following code below:

```js
import styled from "styled-components"

export const NavWrapper = styled.nav`
  grid-column: 2 / span 12;
  grid-row: 1 / 2;
  display: flex;
  align-items: center;

  @media ${props => props.theme.breakpoints.tablet} {
    grid-column: 2 / span 6;
  }
`
```

- Don't forget to export it in the "index.js" in the "elements" folder.

`index.js`

```js
export * from "./ContainerElements"
export * from "./NavElements"
```

- We now have two exports in our index.js inside our "elements" folder.

- Head on to our "components" folder and create a file and name it as "Nav.js".

`Nav.js`

```js
import React from "react"
import { useStaticQuery, Link, graphql } from "gatsby"
import { NavWrapper } from "../elements"

export const Nav = () => {
  const data = useStaticQuery(graphql`
    query {
      logo: file(relativePath: { eq: "logo.png" }) {
        publicURL
      }
    }
  `)
  return (
    <NavWrapper>
      <Link to="/">
        <img src={data.logo.publicURL} alt="My Code Logo" />
      </Link>
    </NavWrapper>
  )
}
```

- Do not to forget to export "Nav.js" in our index.js under the "components" folder.

`index.js`

```js
export * from "./Container"
export * from "./Nav"
```

- We now have two exports in our index.js inside our "components" folder.

- In the "Nav.js there several steps been made"

  - Imported our NavWrapper directly from our NavElements.js to wrap our navigation.
  - Created images folder under the SRC folder, where we can store our images.
  - Added a our logo.png image for our logo.png from images folder.

  - We named our query as "data"
  - We imported Link, useStaticQuery, and graphql from gatsby

<p>
  We've done the Navigation part, we can now import/add it to our
  "Container.js", we can now pass the Nav inside our Container.
</p>

`Container.js`

```js
import React from "react"
import { ContainerWrapper } from "../elements"
import { Nav } from "../components"

export const Container = ({ children }) => {
  return (
    <ContainerWrapper>
      <Nav />
      {children}
    </ContainerWrapper>
  )
}
```
